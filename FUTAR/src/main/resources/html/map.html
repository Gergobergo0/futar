<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>T√©rk√©p</title>
    <style>
        html, body, #map { height: 100%; margin: 0; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
<div id="map"></div>
<script>
    var defaultIcon = L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    var highlightedIcon = L.icon({
        iconUrl: 'https://www.iconsdb.com/icons/preview/red/marker-xxl.png',
        iconSize: [30, 48],
        iconAnchor: [15, 48],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    var map = L.map('map').setView([47.4979, 19.0402], 13);

    var light = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://carto.com/">CartoDB</a>',
        subdomains: 'abcd',
        maxZoom: 19
    });

    var dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://carto.com/">CartoDB</a>',
        subdomains: 'abcd',
        maxZoom: 19
    });

    var allStops = [];
    var selectedMarker = null;

    function logToJava(message) {
        if (window.java && window.java.javaLog) {
            window.java.javaLog(message);
        } else {
            console.warn("Java objektum nem el√©rhet≈ë m√©g");
        }
    }

    function addStopTracked(lat, lng, name, stopId) {
        var marker = L.marker([lat, lng], { icon: defaultIcon });
        marker.bindPopup(name);

        marker.on('click', function () {
            console.log("Marker clicked: " + stopId + " (" + name + ")");

            if (selectedMarker && selectedMarker !== marker) {
                selectedMarker.setIcon(defaultIcon);
            }

            selectedMarker = marker;
            marker.setIcon(highlightedIcon);

            if (window.java && window.java.javaGetStopDetails) {
                window.java.javaGetStopDetails(stopId, name, lat, lng);
            }
        });

        marker.addTo(map);
        allStops.push(marker);
    }


    function updatePopupContent(stopName, htmlContent) {
        logToJava("POPUP")
        console.log("Popup friss√≠t√©se: " + stopName);
        if (selectedMarker) {
            selectedMarker.setPopupContent("<b>" + stopName + "</b><br>" + htmlContent);
            selectedMarker.openPopup(); // üí• ez kell
        }
        }



    function clearStops() {
        for (var i = 0; i < allStops.length; i++) {
            map.removeLayer(allStops[i]);
        }
        allStops = [];
        selectedMarker = null;
    }

    window.focusOn = function(lat, lng) {
        logToJava("üîç focusOn called", lat, lng);
        map.setView([lat, lng], 17);
    };


    light.addTo(map);

    var baseMaps = {
        "Vil√°gos": light,
        "S√∂t√©t": dark
    };

    L.control.layers(baseMaps).addTo(map);
</script>
</body>
</html>
